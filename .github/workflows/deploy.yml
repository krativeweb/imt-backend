- name: Deploy Backend (public_html) with PM2
  run: |
    ssh sQuvhGZjP55xXTwu@13.203.127.190 << 'EOF'
      set -euxo pipefail

      APP_DIR="/home/sQuvhGZjP55xXTwu/imt-hyderabad-api/public_html"

      echo "ðŸ“‚ Moving to project directory"
      cd "$APP_DIR"

      echo "ðŸ” Marking repo as safe for Git"
      git config --global --add safe.directory "$APP_DIR"

      echo "ðŸ“¥ Pulling latest code"
      git pull origin main

      echo "ðŸ“¦ Installing dependencies"
      npm install --production

      echo "ðŸ”„ Restarting PM2 (with env reload)"
      pm2 restart imt-hyderabad-api --update-env

      echo "ðŸ’¾ Saving PM2 process list"
      pm2 save

      echo "âœ… Deployment completed successfully"
    EOF
