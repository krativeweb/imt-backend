- name: Deploy to Server
  run: |
    ssh -o StrictHostKeyChecking=no \
        -o ServerAliveInterval=60 \
        -o ServerAliveCountMax=10 \
        ***@*** << 'EOF'

      set -euo pipefail

      APP_DIR="/home/***/imt-hyderabad-api/public_html"

      echo "ðŸ“‚ Go to app directory"
      cd "$APP_DIR"

      echo "ðŸ” Mark repo as safe"
      git config --global --add safe.directory "$APP_DIR"

      echo "ðŸ“¥ Pull latest code"
      git pull origin main

      echo "ðŸ“¦ Install dependencies"
      npm install --production --no-audit --no-fund

      echo "ðŸ”„ Restart PM2"
      pm2 restart imt-hyderabad-api || pm2 start ecosystem.config.js

      echo "ðŸ’¾ Save PM2 state"
      pm2 save

      echo "âœ… DEPLOY SUCCESS"
    EOF
